<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AlgoTree.shell.builtins &#8212; AlgoTree 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for AlgoTree.shell.builtins</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Built-in shell commands for navigation, file operations, and tree manipulation.</span>

<span class="sd">This module contains all the core commands that make up the tree shell.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.node</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">node</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.pretty_tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">pretty_tree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.shell.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">Forest</span><span class="p">,</span> <span class="n">TreePath</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.shell.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span><span class="p">,</span> <span class="n">CommandResult</span>


<span class="c1"># ANSI color codes</span>
<span class="n">COLORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;black&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;30m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;31m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;32m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yellow&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;33m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;34m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;magenta&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;35m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cyan&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;36m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;white&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;37m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;reset&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dir_blue&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span><span class="p">,</span>  <span class="c1"># Bold blue for directories</span>
<span class="p">}</span>


<div class="viewcode-block" id="colorize">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.colorize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">colorize</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply ANSI color to text.&quot;&quot;&quot;</span>
    <span class="n">color_code</span> <span class="o">=</span> <span class="n">COLORS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="n">COLORS</span><span class="p">[</span><span class="s1">&#39;reset&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">color_code</span><span class="si">}{</span><span class="n">text</span><span class="si">}{</span><span class="n">reset</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">color_code</span> <span class="k">else</span> <span class="n">text</span></div>



<div class="viewcode-block" id="get_timestamp">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.get_timestamp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_timestamp</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get current timestamp in ISO 8601 format.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span></div>



<div class="viewcode-block" id="add_creation_metadata">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.add_creation_metadata">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_creation_metadata</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add creation timestamp to attributes.&quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">get_timestamp</span><span class="p">()</span>
    <span class="n">new_attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;.creation_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
    <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;.modified_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
    <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;.accessed_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
    <span class="k">return</span> <span class="n">new_attrs</span></div>



<div class="viewcode-block" id="add_modification_metadata">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.add_modification_metadata">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_modification_metadata</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add/update modification timestamp.&quot;&quot;&quot;</span>
    <span class="n">new_attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;.modified_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_timestamp</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_attrs</span></div>



<div class="viewcode-block" id="add_access_metadata">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.add_access_metadata">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_access_metadata</span><span class="p">(</span><span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add/update access timestamp.&quot;&quot;&quot;</span>
    <span class="n">new_attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;.accessed_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_timestamp</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_attrs</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Navigation Commands</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="PwdCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.PwdCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PwdCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print working directory.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;pwd&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Print working directory&quot;</span>

<div class="viewcode-block" id="PwdCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.PwdCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Build colored path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Start with tree name</span>
        <span class="n">colored_path</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="s1">&#39;dir_blue&#39;</span><span class="p">)</span>

        <span class="c1"># Add each path component with its color</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">:</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">)</span><span class="o">.</span><span class="n">root</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">:</span>
                <span class="c1"># Find the child node</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current_node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">component</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;.color&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                            <span class="n">colored_component</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;.color&#39;</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">colored_component</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="s1">&#39;dir_blue&#39;</span><span class="p">)</span>
                        <span class="n">colored_path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">colored_component</span>
                        <span class="n">current_node</span> <span class="o">=</span> <span class="n">child</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">colored_path</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CdCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.CdCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CdCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change directory.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cd&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Change directory&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cd &lt;path&gt;&quot;</span>

<div class="viewcode-block" id="CdCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.CdCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># cd with no args goes to forest root</span>
            <span class="n">new_context</span> <span class="o">=</span> <span class="n">ShellContext</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>


<div class="viewcode-block" id="CdCommand.complete">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.CdCommand.complete">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">incomplete</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Complete directory/node names.&quot;&quot;&quot;</span>
        <span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># At forest root, complete tree names</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tree_name</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">tree_names</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">tree_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">incomplete</span><span class="p">):</span>
                    <span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">completions</span>

        <span class="c1"># Within a tree, complete child node names</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">incomplete</span><span class="p">):</span>
                    <span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Add special completions</span>
        <span class="k">if</span> <span class="s1">&#39;..&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">incomplete</span><span class="p">):</span>
            <span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">completions</span></div>
</div>



<div class="viewcode-block" id="LsCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.LsCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LsCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List directory contents.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ls&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;List directory contents&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ls [path] [-l] [-a]&quot;</span>

<div class="viewcode-block" id="LsCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.LsCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Parse options</span>
        <span class="n">long_format</span> <span class="o">=</span> <span class="s1">&#39;-l&#39;</span> <span class="ow">in</span> <span class="n">args</span>
        <span class="n">show_all</span> <span class="o">=</span> <span class="s1">&#39;-a&#39;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="s1">&#39;-la&#39;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="s1">&#39;-al&#39;</span> <span class="ow">in</span> <span class="n">args</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)]</span>

        <span class="c1"># Determine target path</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">target_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span>

        <span class="c1"># At forest root, list trees (no file metaphor here)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="n">trees</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">tree_names</span><span class="p">()</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Add . and .. if -a</span>
            <span class="k">if</span> <span class="n">show_all</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m.</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>  <span class="c1"># blue</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m..</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>  <span class="c1"># blue</span>

            <span class="k">for</span> <span class="n">tree_name</span> <span class="ow">in</span> <span class="n">trees</span><span class="p">:</span>
                <span class="c1"># Hide dot-prefixed trees unless -a flag</span>
                <span class="k">if</span> <span class="n">tree_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">show_all</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">long_format</span><span class="p">:</span>
                    <span class="n">tree</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tree_name</span><span class="p">)</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="k">if</span> <span class="n">tree</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
                        <span class="n">num_children</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">descendants</span><span class="p">()))</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m</span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">/</span><span class="se">\033</span><span class="s2">[0m  (</span><span class="si">{</span><span class="n">num_children</span><span class="si">}</span><span class="s2"> nodes)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m</span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">/</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m</span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">/</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Within a tree, list children (directories) AND attributes (files)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid path&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add . and .. if -a</span>
        <span class="k">if</span> <span class="n">show_all</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m.</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">:</span>  <span class="c1"># Not at tree root</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;34m..</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>

        <span class="c1"># Add child nodes as directories</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="c1"># Hide dot-prefixed subtrees unless -a flag</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">show_all</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check for custom color attribute (dot-prefixed)</span>
            <span class="k">if</span> <span class="s1">&#39;.color&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">colored_name</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;.color&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colored_name</span> <span class="o">=</span> <span class="n">colorize</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="s1">&#39;dir_blue&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">long_format</span><span class="p">:</span>
                <span class="n">num_children</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colored_name</span><span class="si">}</span><span class="s2">  (</span><span class="si">{</span><span class="n">num_children</span><span class="si">}</span><span class="s2"> children)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colored_name</span><span class="p">)</span>

        <span class="c1"># Add attributes as files</span>
        <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Skip dot-prefixed (hidden) attributes unless -a flag</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">show_all</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">long_format</span><span class="p">:</span>
                    <span class="c1"># Show file size (length of value)</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m  (</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="k">if</span> <span class="n">lines</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>


<div class="viewcode-block" id="LsCommand.complete">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.LsCommand.complete">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">incomplete</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Complete directory/node names.&quot;&quot;&quot;</span>
        <span class="c1"># Reuse cd completion logic</span>
        <span class="n">cd_cmd</span> <span class="o">=</span> <span class="n">CdCommand</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cd_cmd</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">incomplete</span><span class="p">)</span></div>
</div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Read Commands</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="CatCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.CatCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CatCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display node attributes or specific attribute value (file-like).&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cat&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Display node attributes or specific attribute value&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;cat [path|attribute_key]&quot;</span>

<div class="viewcode-block" id="CatCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.CatCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Determine target</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># First, check if arg is an attribute key of current node</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="c1"># Treat as attribute key (file-like access)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

            <span class="c1"># Otherwise try as path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Format output (full node display)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;name: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">target_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;attrs:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">target_node</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;attrs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;children: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_leaf: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="StatCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.StatCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StatCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display detailed node information.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;stat&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Display detailed node information&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;stat [path]&quot;</span>

<div class="viewcode-block" id="StatCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.StatCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Determine target</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Collect stats</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">pwd</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">target_context</span><span class="o">.</span><span class="n">pwd</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Type: </span><span class="si">{</span><span class="s1">&#39;directory&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">target_node</span><span class="o">.</span><span class="n">children</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Show metadata (dot-prefixed attributes)</span>
        <span class="n">metadata_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.color&#39;</span><span class="p">,</span> <span class="s1">&#39;.permissions&#39;</span><span class="p">,</span> <span class="s1">&#39;.creation_time&#39;</span><span class="p">,</span> <span class="s1">&#39;.modified_time&#39;</span><span class="p">,</span> <span class="s1">&#39;.accessed_time&#39;</span><span class="p">,</span> <span class="s1">&#39;.order&#39;</span><span class="p">]</span>
        <span class="n">has_metadata</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">target_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">has_metadata</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metadata:&quot;</span><span class="p">)</span>
                    <span class="n">has_metadata</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">display_key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Remove dot prefix for display</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">display_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Tree stats</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tree Statistics:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Depth: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Height: </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Children: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_node</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Descendants: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">target_node</span><span class="o">.</span><span class="n">descendants</span><span class="p">()))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Regular attributes (non-dot-prefixed)</span>
        <span class="n">regular_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">target_node</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">regular_attrs</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Attributes:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">regular_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TreeCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.TreeCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TreeCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display tree structure.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;tree&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Display tree structure&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;tree [path] [-d depth]&quot;</span>

<div class="viewcode-block" id="TreeCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.TreeCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Parse options</span>
        <span class="n">max_depth</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">path_args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-d&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid depth value&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Determine target</span>
        <span class="k">if</span> <span class="n">path_args</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">path_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Generate tree output with color support</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">colored_node_name</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return colored node name if .color attribute exists.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;.color&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">colorize</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;.color&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">pretty_tree</span><span class="p">(</span><span class="n">target_node</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">node_name</span><span class="o">=</span><span class="n">colored_node_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Write Commands</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="MkdirCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.MkdirCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MkdirCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new child node.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;mkdir&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Create a new child node&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;mkdir &lt;name&gt; [key=value ...]&quot;</span>

<div class="viewcode-block" id="MkdirCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.MkdirCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: mkdir &lt;name&gt; [key=value ...]&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Parse attributes from remaining args (key=value format)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Try to parse as number, otherwise keep as string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># Keep as string</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid attribute format: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">. Use key=value&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Cannot create node at forest root&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Add creation metadata (timestamps)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">add_creation_metadata</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># Create new child with attributes</span>
        <span class="n">new_child</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_child</span><span class="p">(</span><span class="n">new_child</span><span class="p">)</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace the node in the tree</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Created node: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_replace_node_in_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">new_node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace a node at the given path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_node</span>

        <span class="c1"># Navigate to parent and replace child</span>
        <span class="n">component</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">new_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">component</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remaining</span><span class="p">:</span>
                    <span class="c1"># Recurse deeper</span>
                    <span class="n">new_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This is the node to replace</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">with_children</span><span class="p">(</span><span class="o">*</span><span class="n">new_children</span><span class="p">)</span></div>



<div class="viewcode-block" id="TouchCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.TouchCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TouchCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create empty attribute(s) (file metaphor).&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;touch&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Create empty attribute(s) (files)&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;touch &lt;name&gt; [name2 ...]&quot;</span>

<div class="viewcode-block" id="TouchCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.TouchCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: touch &lt;name&gt; [name2 ...]&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Create empty attributes for each name</span>
        <span class="n">new_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># If attribute already exists, just update access/modified time</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">new_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Add/update modification and access timestamps</span>
        <span class="n">timestamp_attrs</span> <span class="o">=</span> <span class="n">add_modification_metadata</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">timestamp_attrs</span> <span class="o">=</span> <span class="n">add_access_metadata</span><span class="p">(</span><span class="n">timestamp_attrs</span><span class="p">)</span>

        <span class="c1"># Merge with new attributes</span>
        <span class="n">timestamp_attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_attrs</span><span class="p">)</span>

        <span class="c1"># Update node with new attributes</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="n">timestamp_attrs</span><span class="p">)</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="n">files_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Created file(s): </span><span class="si">{</span><span class="n">files_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="MktreeCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.MktreeCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MktreeCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new tree in the forest.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;mktree&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Create a new tree in the forest&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;mktree &lt;name&gt; [root_name] [key=value ...]&quot;</span>

<div class="viewcode-block" id="MktreeCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.MktreeCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: mktree &lt;name&gt; [root_name] [key=value ...]&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">tree_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tree_name</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree &#39;</span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Check if second arg is root name or attribute</span>
        <span class="c1"># Default: root node name matches tree name</span>
        <span class="n">root_name</span> <span class="o">=</span> <span class="n">tree_name</span>
        <span class="n">attr_start</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">root_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">attr_start</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># Parse attributes from remaining args</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="n">attr_start</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Try to parse as number, otherwise keep as string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid attribute format: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">. Use key=value&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Create new tree with attributes</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">root_name</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">)</span> <span class="k">if</span> <span class="n">attrs</span> <span class="k">else</span> <span class="n">Node</span><span class="p">(</span><span class="n">root_name</span><span class="p">)</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tree_name</span><span class="p">,</span> <span class="n">Tree</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Created tree: </span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="SetAttrCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.SetAttrCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SetAttrCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set or update node attributes.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;setattr&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Set or update node attributes&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;setattr &lt;key&gt;=&lt;value&gt; [key2=value2 ...]&quot;</span>

<div class="viewcode-block" id="SetAttrCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.SetAttrCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: setattr key=value [key2=value2 ...]&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Parse attributes</span>
        <span class="n">new_attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>  <span class="c1"># Copy existing attrs</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid format: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">. Use key=value&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Try to parse as number, otherwise keep as string</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">new_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># Keep as string</span>
                <span class="n">new_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Update node with new attributes</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="n">new_attrs</span><span class="p">)</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Updated attributes: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">new_attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="RmAttrCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.RmAttrCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RmAttrCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove node attributes.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;rmattr&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Remove node attributes&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;rmattr &lt;key&gt; [key2 ...]&quot;</span>

<div class="viewcode-block" id="RmAttrCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.RmAttrCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: rmattr key [key2 ...]&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Remove specified attributes</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">without_attrs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Removed attributes: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ColorCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ColorCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ColorCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set color attribute for current node or path.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;color&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Set color attribute for node&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;color &lt;color_name&gt; [path]&quot;</span>

<div class="viewcode-block" id="ColorCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ColorCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="s2">&quot;Usage: color &lt;color_name&gt; [path]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Colors: red, green, yellow, blue, magenta, cyan, white&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span>
            <span class="p">)</span>

        <span class="n">color_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Validate color (basic ANSI colors)</span>
        <span class="n">valid_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">color_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_colors</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid color: </span><span class="si">{</span><span class="n">color_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Valid colors: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_colors</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span>
            <span class="p">)</span>

        <span class="c1"># Determine target node</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Color a specific path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">_current_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Color current node</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Set color attribute (using dot-prefix for hidden metadata)</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">target_node</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;.color&#39;</span><span class="p">:</span> <span class="n">color_name</span><span class="p">})</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">target_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Set color &#39;</span><span class="si">{</span><span class="n">color_name</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">new_context</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ChmodCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ChmodCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ChmodCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set permissions for node.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;chmod&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Set permissions for node&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;chmod &lt;permissions&gt; [path]&quot;</span>

<div class="viewcode-block" id="ChmodCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ChmodCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="s2">&quot;Usage: chmod &lt;permissions&gt; [path]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Examples: chmod rwx, chmod r-x, chmod 755&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span>
            <span class="p">)</span>

        <span class="n">permissions</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Determine target node</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Set permissions on specific path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">cd</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">current_node</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">target_context</span><span class="o">.</span><span class="n">_current_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set permissions on current node</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_node</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Set permissions attribute (using dot-prefix for hidden metadata)</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">target_node</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;.permissions&#39;</span><span class="p">:</span> <span class="n">permissions</span><span class="p">})</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">target_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Set permissions &#39;</span><span class="si">{</span><span class="n">permissions</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">target_node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">new_context</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ConfigCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ConfigCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ConfigCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manage tree configuration via .config subtree.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;config&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Manage tree configuration&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;config [key] [value]&quot;</span>

<div class="viewcode-block" id="ConfigCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ConfigCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Find or create .config node</span>
        <span class="n">config_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;.config&#39;</span><span class="p">:</span>
                <span class="n">config_node</span> <span class="o">=</span> <span class="n">child</span>
                <span class="k">break</span>

        <span class="c1"># No args: show all config</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config_node</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;No configuration set&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Configuration:&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_node</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>  <span class="c1"># Skip metadata</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># One arg: show specific config value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config_node</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config key not found: </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

            <span class="n">key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">config_node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config key not found: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Two args: set config value</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Auto-parse value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">):</span>
                <span class="n">parsed_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">parsed_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parsed_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">parsed_value</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># Keep as string</span>

        <span class="c1"># Create or update .config node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_node</span><span class="p">:</span>
            <span class="c1"># Create .config node</span>
            <span class="n">config_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s1">&#39;.config&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">parsed_value</span><span class="p">})</span>
            <span class="n">new_root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">with_child</span><span class="p">(</span><span class="n">config_node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update existing .config node</span>
            <span class="n">new_config</span> <span class="o">=</span> <span class="n">config_node</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">parsed_value</span><span class="p">})</span>
            <span class="c1"># Replace .config in tree</span>
            <span class="n">new_children</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;.config&#39;</span><span class="p">:</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_config</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">new_root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">with_children</span><span class="p">(</span><span class="o">*</span><span class="n">new_children</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">Tree</span><span class="p">(</span><span class="n">new_root</span><span class="p">))</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Set config &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; = </span><span class="si">{</span><span class="n">parsed_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">new_context</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="RmtreeCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.RmtreeCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RmtreeCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a tree from the forest.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;rmtree&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Remove a tree from the forest&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;rmtree &lt;name&gt;&quot;</span>

<div class="viewcode-block" id="RmtreeCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.RmtreeCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: rmtree &lt;name&gt;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">tree_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tree_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tree &#39;</span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Remove tree</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tree_name</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">ShellContext</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>  <span class="c1"># Go to forest root</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Removed tree: </span><span class="si">{</span><span class="n">tree_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="EchoCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.EchoCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EchoCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print text or write to attributes (file-like).&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;echo&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Print text or write to attributes (use &gt; key or &gt;&gt; key)&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;echo &lt;text&gt; [&gt; key | &gt;&gt; key]&quot;</span>

<div class="viewcode-block" id="EchoCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.EchoCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Check for redirection operators</span>
        <span class="n">redirect_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">redirect_key</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Find &gt; or &gt;&gt; in args</span>
        <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
            <span class="n">redirect_mode</span> <span class="o">=</span> <span class="s1">&#39;write&#39;</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                <span class="n">redirect_key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: echo &lt;text&gt; &gt; &lt;key&gt;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;&gt;&gt;&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)</span>
            <span class="n">redirect_mode</span> <span class="o">=</span> <span class="s1">&#39;append&#39;</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                <span class="n">redirect_key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: echo &lt;text&gt; &gt;&gt; &lt;key&gt;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Join remaining args as text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="c1"># If no redirection, just print</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">redirect_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Must be in a tree to write attributes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Handle redirection</span>
        <span class="k">if</span> <span class="n">redirect_mode</span> <span class="o">==</span> <span class="s1">&#39;write&#39;</span><span class="p">:</span>
            <span class="c1"># Overwrite attribute</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">redirect_key</span><span class="p">:</span> <span class="n">text</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># append</span>
            <span class="c1"># Append to existing value with newline separator</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redirect_key</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">existing</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">redirect_key</span><span class="p">:</span> <span class="n">new_value</span><span class="p">})</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">new_context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ReadFileCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ReadFileCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ReadFileCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load content from filesystem file into attribute.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;readfile&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Load content from filesystem file into attribute&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;readfile &lt;filepath&gt; &lt;attribute_key&gt;&quot;</span>

<div class="viewcode-block" id="ReadFileCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ReadFileCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Usage: readfile &lt;filepath&gt; &lt;attribute_key&gt;&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">attr_key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Must be in a tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Not in a tree&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Invalid current location&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Read file from filesystem</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Set attribute</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">with_attrs</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">attr_key</span><span class="p">:</span> <span class="n">content</span><span class="p">})</span>

        <span class="c1"># Update tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">current_tree</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Current tree not found&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Replace node in tree</span>
        <span class="n">mkdir_cmd</span> <span class="o">=</span> <span class="n">MkdirCommand</span><span class="p">()</span>
        <span class="n">new_tree</span> <span class="o">=</span> <span class="n">mkdir_cmd</span><span class="o">.</span><span class="n">_replace_node_in_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">_current_path</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="c1"># Update forest</span>
        <span class="n">new_forest</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">forest</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">current_tree_name</span><span class="p">,</span> <span class="n">new_tree</span><span class="p">)</span>
        <span class="n">new_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">update_forest</span><span class="p">(</span><span class="n">new_forest</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters from </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2"> into &#39;</span><span class="si">{</span><span class="n">attr_key</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">new_context</span>
        <span class="p">)</span></div>
</div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Helper Commands</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="HelpCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.HelpCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HelpCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display help information.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;help&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;?&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Display help information&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;help [command]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span> <span class="o">=</span> <span class="n">registry</span>

<div class="viewcode-block" id="HelpCommand.set_registry">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.HelpCommand.set_registry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the command registry for help lookups.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span> <span class="o">=</span> <span class="n">registry</span></div>


<div class="viewcode-block" id="HelpCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.HelpCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Command registry not available&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># Show help for specific command</span>
            <span class="n">cmd_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown command: </span><span class="si">{</span><span class="n">cmd_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;Command: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Description: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Usage: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">usage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aliases: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Show all commands</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Available commands:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">all_commands</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">aliases_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">aliases</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">aliases_str</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Use &#39;help &lt;command&gt;&#39; for detailed information.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExitCommand">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ExitCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExitCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit the shell.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;exit&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;quit&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Exit the shell&quot;</span>

<div class="viewcode-block" id="ExitCommand.execute">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.ExitCommand.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ShellContext</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pipe_input</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommandResult</span><span class="p">:</span>
        <span class="c1"># This will be handled specially by the shell</span>
        <span class="k">return</span> <span class="n">CommandResult</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></div>
</div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Command Registration</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="create_builtin_registry">
<a class="viewcode-back" href="../../../AlgoTree.shell.html#AlgoTree.shell.builtins.create_builtin_registry">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_builtin_registry</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a command registry with all built-in commands.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.shell.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommandRegistry</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.shell.advanced</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_advanced_commands</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree.shell.io_commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">SaveCommand</span><span class="p">,</span> <span class="n">LoadCommand</span><span class="p">,</span> <span class="n">ExportCommand</span><span class="p">,</span> <span class="n">ToGraphCommand</span><span class="p">,</span> <span class="n">FromGraphCommand</span>

    <span class="n">registry</span> <span class="o">=</span> <span class="n">CommandRegistry</span><span class="p">()</span>

    <span class="c1"># Navigation</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PwdCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CdCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">LsCommand</span><span class="p">())</span>

    <span class="c1"># Read</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CatCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">StatCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TreeCommand</span><span class="p">())</span>

    <span class="c1"># Write</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MkdirCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TouchCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MktreeCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">RmtreeCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SetAttrCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">RmAttrCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ColorCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ChmodCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ConfigCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">EchoCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ReadFileCommand</span><span class="p">())</span>

    <span class="c1"># I/O</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SaveCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">LoadCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ExportCommand</span><span class="p">())</span>

    <span class="c1"># AlgoGraph interop (available even if AlgoGraph not installed - will give helpful error)</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ToGraphCommand</span><span class="p">())</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">FromGraphCommand</span><span class="p">())</span>

    <span class="c1"># Advanced commands (queries, transformations, analysis)</span>
    <span class="n">register_advanced_commands</span><span class="p">(</span><span class="n">registry</span><span class="p">)</span>

    <span class="c1"># Helper</span>
    <span class="n">help_cmd</span> <span class="o">=</span> <span class="n">HelpCommand</span><span class="p">()</span>
    <span class="n">help_cmd</span><span class="o">.</span><span class="n">set_registry</span><span class="p">(</span><span class="n">registry</span><span class="p">)</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">help_cmd</span><span class="p">)</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ExitCommand</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">registry</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">AlgoTree</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fluent_api.html">AlgoTree Fluent API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pattern_matching.html">Pattern Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformations.html">Tree Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">AlgoTree: Comprehensive Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookbook.html">AlgoTree Cookbook</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Traditional API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../flat_forest.html">FlatForest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../treenode.html">TreeNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../flat_forest_nb.html">FlatForest Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../expr_trees_nb.html">Expression Trees and Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../identity.html">Understanding Equality in Trees and Nodes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools &amp; Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../jt.html">jt Command-Line Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">AlgoTree</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alex Towell.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>