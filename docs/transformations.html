<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tree Transformations &#8212; AlgoTree 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="AlgoTree: Comprehensive Tutorial" href="tutorial.html" />
    <link rel="prev" title="Pattern Matching" href="pattern_matching.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tree-transformations">
<h1>Tree Transformations<a class="headerlink" href="#tree-transformations" title="Link to this heading">¶</a></h1>
<p>AlgoTree provides two families of transformation functions inspired by dotsuite’s Shape pillar:</p>
<ul class="simple">
<li><p><strong>Closed Transformations (dotmod family)</strong>: Tree → Tree transformations that preserve structure</p></li>
<li><p><strong>Open Transformations (dotpipe family)</strong>: Tree → Any transformations that reshape to any structure</p></li>
</ul>
<section id="dot-notation-and-escaping">
<h2>Dot Notation and Escaping<a class="headerlink" href="#dot-notation-and-escaping" title="Link to this heading">¶</a></h2>
<p>All transformation functions use dot notation for path navigation:</p>
<ul class="simple">
<li><p>Dots (<code class="docutils literal notranslate"><span class="pre">.</span></code>) separate path components</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">\.</span></code> to escape literal dots in node names</p></li>
<li><p>Wildcards: <code class="docutils literal notranslate"><span class="pre">*</span></code> matches any single node, <code class="docutils literal notranslate"><span class="pre">**</span></code> matches any subtree</p></li>
<li><p>Attributes: <code class="docutils literal notranslate"><span class="pre">[key=value]</span></code> or <code class="docutils literal notranslate"><span class="pre">[key]</span></code> to check existence</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Match nodes with dots in names</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;files.doc1\.txt&quot;</span><span class="p">)</span>  <span class="c1"># Matches node named &quot;doc1.txt&quot;</span>

<span class="c1"># Match all .txt files</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;files.*\.txt&quot;</span><span class="p">)</span>     <span class="c1"># Wildcard with escaped dot</span>

<span class="c1"># Match nodes with attributes</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[type=file]&quot;</span><span class="p">)</span>    <span class="c1"># All nodes with type=&quot;file&quot;</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[size]&quot;</span><span class="p">)</span>         <span class="c1"># All nodes that have a size attribute</span>
</pre></div>
</div>
</section>
<section id="closed-transformations-dotmod-family">
<h2>Closed Transformations (dotmod family)<a class="headerlink" href="#closed-transformations-dotmod-family" title="Link to this heading">¶</a></h2>
<p>These functions transform trees while preserving their tree structure.</p>
<section id="dotmod">
<h3>dotmod<a class="headerlink" href="#dotmod" title="Link to this heading">¶</a></h3>
<p>Apply transformations to specific nodes using dot paths.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotmod</span>

<span class="c1"># Update node payloads</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;app.config&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">9000</span><span class="p">},</span>
    <span class="s2">&quot;app.database&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;prod.db.com&quot;</span><span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Rename nodes</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;app.cache&quot;</span><span class="p">:</span> <span class="s2">&quot;redis_cache&quot;</span><span class="p">})</span>

<span class="c1"># Apply functions</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;app.config&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Clear payload</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;app.temp&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="dotmap">
<h3>dotmap<a class="headerlink" href="#dotmap" title="Link to this heading">¶</a></h3>
<p>Map transformations over nodes matching a pattern.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotmap</span>

<span class="c1"># Transform all nodes</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmap</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

<span class="c1"># Transform specific fields</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmap</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># Convert to bytes</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1"># Apply to specific pattern</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotmap</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
             <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;validated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
             <span class="n">dot_path</span><span class="o">=</span><span class="s2">&quot;app.modules.*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dotprune">
<h3>dotprune<a class="headerlink" href="#dotprune" title="Link to this heading">¶</a></h3>
<p>Remove nodes from tree based on condition.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotprune</span>

<span class="c1"># Remove by pattern</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotprune</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**.test_*&quot;</span><span class="p">)</span>

<span class="c1"># Remove by predicate</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotprune</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;deprecated&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

<span class="c1"># Keep structure but clear nodes</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotprune</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**.temp&quot;</span><span class="p">,</span> <span class="n">keep_structure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dotmerge">
<h3>dotmerge<a class="headerlink" href="#dotmerge" title="Link to this heading">¶</a></h3>
<p>Merge two trees with various strategies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotmerge</span>

<span class="c1"># Overlay (tree2 overrides tree1)</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">dotmerge</span><span class="p">(</span><span class="n">tree1</span><span class="p">,</span> <span class="n">tree2</span><span class="p">,</span> <span class="s2">&quot;overlay&quot;</span><span class="p">)</span>

<span class="c1"># Underlay (tree1 takes precedence)</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">dotmerge</span><span class="p">(</span><span class="n">tree1</span><span class="p">,</span> <span class="n">tree2</span><span class="p">,</span> <span class="s2">&quot;underlay&quot;</span><span class="p">)</span>

<span class="c1"># Combine (merge arrays and dicts)</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">dotmerge</span><span class="p">(</span><span class="n">tree1</span><span class="p">,</span> <span class="n">tree2</span><span class="p">,</span> <span class="s2">&quot;combine&quot;</span><span class="p">)</span>

<span class="c1"># Custom resolution</span>
<span class="k">def</span><span class="w"> </span><span class="nf">resolver</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
    <span class="c1"># Custom merge logic</span>
    <span class="k">return</span> <span class="n">Node</span><span class="p">(</span><span class="n">node2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">node1</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">node2</span><span class="o">.</span><span class="n">payload</span><span class="p">})</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">dotmerge</span><span class="p">(</span><span class="n">tree1</span><span class="p">,</span> <span class="n">tree2</span><span class="p">,</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">conflict_resolver</span><span class="o">=</span><span class="n">resolver</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dotannotate">
<h3>dotannotate<a class="headerlink" href="#dotannotate" title="Link to this heading">¶</a></h3>
<p>Add metadata annotations to nodes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotannotate</span>

<span class="c1"># Add computed annotations</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotannotate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                  <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span>
                      <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                      <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">get_path</span><span class="p">()),</span>
                      <span class="s2">&quot;has_children&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                  <span class="p">},</span>
                  <span class="n">annotation_key</span><span class="o">=</span><span class="s2">&quot;_meta&quot;</span><span class="p">)</span>

<span class="c1"># Add static annotations to specific nodes</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotannotate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                  <span class="p">{</span><span class="s2">&quot;reviewed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">},</span>
                  <span class="n">dot_path</span><span class="o">=</span><span class="s2">&quot;**.critical_*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dotvalidate">
<h3>dotvalidate<a class="headerlink" href="#dotvalidate" title="Link to this heading">¶</a></h3>
<p>Validate nodes against constraints.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotvalidate</span>

<span class="c1"># Validate with predicate (raises on failure)</span>
<span class="n">dotvalidate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
           <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">,</span>
           <span class="n">dot_path</span><span class="o">=</span><span class="s2">&quot;**[type=file]&quot;</span><span class="p">)</span>

<span class="c1"># Get invalid nodes instead of raising</span>
<span class="n">invalid</span> <span class="o">=</span> <span class="n">dotvalidate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                     <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">,</span>
                     <span class="n">raise_on_invalid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Validate required attributes</span>
<span class="n">dotvalidate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
           <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;module&quot;</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
           <span class="n">dot_path</span><span class="o">=</span><span class="s2">&quot;app.modules.*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="additional-closed-transformations">
<h3>Additional Closed Transformations<a class="headerlink" href="#additional-closed-transformations" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">dotgraft</span><span class="p">,</span>      <span class="c1"># Graft subtree at specific points</span>
    <span class="n">dotsplit</span><span class="p">,</span>      <span class="c1"># Split tree extracting subtrees</span>
    <span class="n">dotflatten</span><span class="p">,</span>    <span class="c1"># Flatten to list of nodes</span>
    <span class="n">dotreduce</span><span class="p">,</span>     <span class="c1"># Reduce tree to single value</span>
    <span class="n">dotnormalize</span>   <span class="c1"># Normalize node names</span>
<span class="p">)</span>

<span class="c1"># Graft a subtree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotgraft</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;app.modules&quot;</span><span class="p">,</span> <span class="n">new_module_tree</span><span class="p">)</span>

<span class="c1"># Split tree</span>
<span class="n">tree</span><span class="p">,</span> <span class="n">extracted</span> <span class="o">=</span> <span class="n">dotsplit</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;app.deprecated&quot;</span><span class="p">)</span>

<span class="c1"># Flatten tree</span>
<span class="n">all_nodes</span> <span class="o">=</span> <span class="n">dotflatten</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[type=file]&quot;</span><span class="p">)</span>

<span class="c1"># Reduce to aggregate value</span>
<span class="n">total_size</span> <span class="o">=</span> <span class="n">dotreduce</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                      <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Normalize names</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">dotnormalize</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>  <span class="c1"># my-node -&gt; my_node</span>
</pre></div>
</div>
</section>
</section>
<section id="open-transformations-dotpipe-family">
<h2>Open Transformations (dotpipe family)<a class="headerlink" href="#open-transformations-dotpipe-family" title="Link to this heading">¶</a></h2>
<p>These functions transform trees into arbitrary data structures.</p>
<section id="dotpipe">
<h3>dotpipe<a class="headerlink" href="#dotpipe" title="Link to this heading">¶</a></h3>
<p>The main pipeline function for chaining transformations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotpipe</span>

<span class="c1"># Extract all names</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">dotpipe</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
               <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">traverse_preorder</span><span class="p">()])</span>

<span class="c1"># Multi-stage pipeline</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">dotpipe</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;**[type=file]&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="p">),</span>  <span class="c1"># Extract payloads</span>
                <span class="k">lambda</span> <span class="n">payloads</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">payloads</span><span class="p">],</span>  <span class="c1"># Get sizes</span>
                <span class="nb">sum</span><span class="p">)</span>  <span class="c1"># Total size</span>

<span class="c1"># Convert to different format</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">dotpipe</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">to_dict</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="conversion-functions">
<h3>Conversion Functions<a class="headerlink" href="#conversion-functions" title="Link to this heading">¶</a></h3>
<p>Convert trees to common data structures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">to_dict</span><span class="p">,</span>           <span class="c1"># Nested dictionary</span>
    <span class="n">to_list</span><span class="p">,</span>           <span class="c1"># Flat list</span>
    <span class="n">to_paths</span><span class="p">,</span>          <span class="c1"># Path strings</span>
    <span class="n">to_adjacency_list</span><span class="p">,</span> <span class="c1"># Graph adjacency list</span>
    <span class="n">to_edge_list</span><span class="p">,</span>      <span class="c1"># Edge pairs</span>
    <span class="n">to_nested_lists</span><span class="p">,</span>   <span class="c1"># S-expressions</span>
    <span class="n">to_table</span>          <span class="c1"># Tabular/DataFrame format</span>
<span class="p">)</span>

<span class="c1"># Convert to dictionary</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">to_dict</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="c1"># {&quot;name&quot;: &quot;root&quot;, &quot;children&quot;: [...], ...}</span>

<span class="c1"># Get all paths</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">to_paths</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="c1"># [&quot;root&quot;, &quot;root.child1&quot;, &quot;root.child2&quot;, ...]</span>

<span class="c1"># With payloads</span>
<span class="n">path_data</span> <span class="o">=</span> <span class="n">to_paths</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">include_payload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># {&quot;root&quot;: {...}, &quot;root.child1&quot;: {...}, ...}</span>

<span class="c1"># For graph algorithms</span>
<span class="n">adj</span> <span class="o">=</span> <span class="n">to_adjacency_list</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="c1"># {&quot;root&quot;: [&quot;child1&quot;, &quot;child2&quot;], ...}</span>

<span class="n">edges</span> <span class="o">=</span> <span class="n">to_edge_list</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="c1"># [(&quot;root&quot;, &quot;child1&quot;), (&quot;root&quot;, &quot;child2&quot;), ...]</span>

<span class="c1"># For DataFrames</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">to_table</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">])</span>
<span class="c1"># df = pd.DataFrame(rows)</span>
</pre></div>
</div>
</section>
<section id="data-extraction">
<h3>Data Extraction<a class="headerlink" href="#data-extraction" title="Link to this heading">¶</a></h3>
<p>Extract and collect data from trees.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">dotextract</span><span class="p">,</span>   <span class="c1"># Extract with custom function</span>
    <span class="n">dotcollect</span><span class="p">,</span>   <span class="c1"># Collect/aggregate data</span>
    <span class="n">dotgroup</span><span class="p">,</span>     <span class="c1"># Group nodes by key</span>
    <span class="n">dotpartition</span><span class="p">,</span> <span class="c1"># Split into two groups</span>
    <span class="n">dotproject</span>    <span class="c1"># SQL-like projection</span>
<span class="p">)</span>

<span class="c1"># Extract specific data</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="n">dotextract</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                  <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">),</span>
                  <span class="n">dot_path</span><span class="o">=</span><span class="s2">&quot;**[type=file]&quot;</span><span class="p">)</span>

<span class="c1"># Collect statistics</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">dotcollect</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                  <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="p">{</span>
                      <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                  <span class="p">},</span>
                  <span class="n">initial</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="c1"># Group by attribute</span>
<span class="n">by_type</span> <span class="o">=</span> <span class="n">dotgroup</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span>
<span class="c1"># {&quot;file&quot;: [node1, node2], &quot;dir&quot;: [node3], ...}</span>

<span class="c1"># Partition nodes</span>
<span class="n">large</span><span class="p">,</span> <span class="n">small</span> <span class="o">=</span> <span class="n">dotpartition</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
                           <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Project specific fields</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dotproject</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">])</span>
<span class="c1"># [{&quot;name&quot;: &quot;...&quot;, &quot;size&quot;: ..., &quot;type&quot;: &quot;...&quot;}, ...]</span>
</pre></div>
</div>
</section>
<section id="specialized-conversions">
<h3>Specialized Conversions<a class="headerlink" href="#specialized-conversions" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_graphviz_data</span><span class="p">,</span> <span class="n">to_json_schema</span>

<span class="c1"># For visualization</span>
<span class="n">viz_data</span> <span class="o">=</span> <span class="n">to_graphviz_data</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="c1"># {&quot;nodes&quot;: [...], &quot;edges&quot;: [...]}</span>

<span class="c1"># Convert to JSON Schema</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">to_json_schema</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="in-place-vs-copy-operations">
<h2>In-Place vs Copy Operations<a class="headerlink" href="#in-place-vs-copy-operations" title="Link to this heading">¶</a></h2>
<p>Most transformation functions support an <code class="docutils literal notranslate"><span class="pre">in_place</span></code> parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a copy (default)</span>
<span class="n">new_tree</span> <span class="o">=</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;app.config&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>
<span class="c1"># Original tree unchanged</span>

<span class="c1"># Modify in place</span>
<span class="n">dotmod</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;app.config&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}},</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Original tree modified</span>
</pre></div>
</div>
</section>
<section id="chaining-transformations">
<h2>Chaining Transformations<a class="headerlink" href="#chaining-transformations" title="Link to this heading">¶</a></h2>
<p>Transformations can be chained for complex operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AlgoTree</span><span class="w"> </span><span class="kn">import</span> <span class="n">dotpipe</span><span class="p">,</span> <span class="n">dotmod</span><span class="p">,</span> <span class="n">dotprune</span><span class="p">,</span> <span class="n">to_dict</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">dotpipe</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
    <span class="c1"># First normalize names</span>
    <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">dotnormalize</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
    <span class="c1"># Remove deprecated nodes</span>
    <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">dotprune</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;deprecated&quot;</span><span class="p">)),</span>
    <span class="c1"># Update configurations</span>
    <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">dotmod</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;app.config&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="s2">&quot;production&quot;</span><span class="p">}}),</span>
    <span class="c1"># Convert to dict</span>
    <span class="n">to_dict</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pattern-matching-reference">
<h2>Pattern Matching Reference<a class="headerlink" href="#pattern-matching-reference" title="Link to this heading">¶</a></h2>
<p>Patterns support various matching strategies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - Exact name match</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> - Single wildcard</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">**</span></code> - Deep wildcard (any subtree)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.txt</span></code> - Wildcard with suffix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[attr=value]</span></code> - Attribute match</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[attr]</span></code> - Attribute existence</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~regex</span></code> - Regex pattern</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%fuzzy</span></code> - Fuzzy matching</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[?(&#64;.size</span> <span class="pre">&gt;</span> <span class="pre">100)]</span></code> - Predicate expressions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[0]</span></code>, <code class="docutils literal notranslate"><span class="pre">[1:3]</span></code> - Array indexing/slicing</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Various pattern examples</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;app.config&quot;</span><span class="p">)</span>           <span class="c1"># Exact path</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;app.*.settings&quot;</span><span class="p">)</span>       <span class="c1"># Wildcard</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;app.**&quot;</span><span class="p">)</span>               <span class="c1"># All descendants</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[type=file]&quot;</span><span class="p">)</span>        <span class="c1"># Attribute filter</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[size]&quot;</span><span class="p">)</span>             <span class="c1"># Has attribute</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;files.*\.txt&quot;</span><span class="p">)</span>         <span class="c1"># Escaped dot</span>
<span class="n">dotmatch</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;**[?(@.size &gt; 1000)]&quot;</span><span class="p">)</span> <span class="c1"># Size predicate</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">AlgoTree</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="fluent_api.html">AlgoTree Fluent API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="pattern_matching.html">Pattern Matching</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tree Transformations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dot-notation-and-escaping">Dot Notation and Escaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#closed-transformations-dotmod-family">Closed Transformations (dotmod family)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#open-transformations-dotpipe-family">Open Transformations (dotpipe family)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-place-vs-copy-operations">In-Place vs Copy Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chaining-transformations">Chaining Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pattern-matching-reference">Pattern Matching Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">AlgoTree: Comprehensive Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">AlgoTree Cookbook</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Traditional API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flat_forest.html">FlatForest</a></li>
<li class="toctree-l1"><a class="reference internal" href="treenode.html">TreeNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="flat_forest_nb.html">FlatForest Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="expr_trees_nb.html">Expression Trees and Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity.html">Understanding Equality in Trees and Nodes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools &amp; Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="jt.html">jt Command-Line Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">AlgoTree</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="pattern_matching.html" title="previous chapter">Pattern Matching</a></li>
      <li>Next: <a href="tutorial.html" title="next chapter">AlgoTree: Comprehensive Tutorial</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alex Towell.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/transformations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>